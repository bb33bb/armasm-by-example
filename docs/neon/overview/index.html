<!doctype html><html lang=en-us dir=ltr>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="NEON Overview #  With all of the cool things computers can do these days, this may be one of the most exciting things. Many times in computing you need to do the same operation to a set of data. This could include color correcting pixels on a screen, running a cryptography algorithm, and determining reflection/blur results. For the longest time, processors were limited to calculating these with one instruction that resulted in one data point.">
<meta name=theme-color content="#FFFFFF">
<meta name=color-scheme content="light dark"><meta property="og:title" content="NEON Overview">
<meta property="og:description" content="NEON Overview #  With all of the cool things computers can do these days, this may be one of the most exciting things. Many times in computing you need to do the same operation to a set of data. This could include color correcting pixels on a screen, running a cryptography algorithm, and determining reflection/blur results. For the longest time, processors were limited to calculating these with one instruction that resulted in one data point.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://armasm.com/docs/neon/overview/"><meta property="article:section" content="docs">
<title>NEON Overview | ARM Assembly By Example</title>
<link rel=manifest href=/manifest.json>
<link rel=icon href=/favicon.png type=image/x-icon>
<link rel=stylesheet href=/book.min.c58292d36b18b675680ab9baea2029204537b839ea72f258746ec0f32ce8d6c8.css integrity="sha256-xYKS02sYtnVoCrm66iApIEU3uDnqcvJYdG7A8yzo1sg=" crossorigin=anonymous>
<script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.cdf1d3339ad599910ecaf0b922791999eccee31382959665fd94442ac92b40e9.js integrity="sha256-zfHTM5rVmZEOyvC5InkZmezO4xOClZZl/ZREKskrQOk=" crossorigin=anonymous></script>
<style>.blink_text{animation:.5s blinker linear infinite;color:red}@keyframes blinker{0%{opacity:1}50%{opacity:0}100%{opacity:1}}</style>
</head>
<body dir=ltr>
<input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control>
<main class="container flex">
<aside class=book-menu>
<div class=book-menu-content>
<nav>
<h2 class=book-brand>
<a class="flex align-center" href=/><span>ARM Assembly By Example</span>
</a>
</h2>
<div class=book-search>
<input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/>
<div class="book-search-spinner hidden"></div>
<ul id=book-search-results></ul>
</div>
<ul>
<li class=book-section-flat>
<span>Getting to Hello World</span>
<ul>
<li>
<a href=/docs/getting-to-hello-world/basics/>The Basics</a>
</li>
<li>
<a href=/docs/getting-to-hello-world/exiting/>Program 1: Exiting</a>
</li>
<li>
<a href=/docs/getting-to-hello-world/hello-world/>Program 2: Hello World</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>Registers and Memory</span>
<ul>
<li>
<a href=/docs/registers-and-memory/register-overview/>Register Overview</a>
</li>
<li>
<a href=/docs/registers-and-memory/memory-overview/>Memory Overview</a>
</li>
<li>
<a href=/docs/registers-and-memory/find-the-otter/>Program 3: Find the Otter</a>
</li>
<li>
<a href=/docs/registers-and-memory/memory-copy/>Program 4: Memory Copy</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>Branches and Conditionals</span>
<ul>
<li>
<a href=/docs/branches-and-conditionals/conditionals/>Conditionals</a>
</li>
<li>
<a href=/docs/branches-and-conditionals/branches-and-loops/>Branches and Loops</a>
</li>
<li>
<a href=/docs/branches-and-conditionals/hello-world-revisited/>Program 5: Hello World Revisited</a>
</li>
<li>
<a href=/docs/branches-and-conditionals/sticky-keyboard/>Program 6: Sticky Keyboard</a>
</li>
<li>
<a href=/docs/branches-and-conditionals/inspecting-our-program/>Inspecting Our Program</a>
</li>
<li>
<a href=/docs/branches-and-conditionals/cloning-myself/>Program 7: Cloning Myself</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>Arithmetic</span>
<ul>
<li>
<a href=/docs/arithmetic/errors-and-tests/>Errors and Tests</a>
</li>
<li>
<a href=/docs/arithmetic/datatypes/>Datatypes</a>
</li>
<li>
<a href=/docs/arithmetic/multiplication/>Multiplication</a>
</li>
<li>
<a href=/docs/arithmetic/itoa/>Program 8: ITOA</a>
</li>
<li>
<a href=/docs/arithmetic/the-stack/>The Stack</a>
</li>
<li>
<a href=/docs/arithmetic/factorial/>Program 9: Factorials</a>
</li>
<li>
<a href=/docs/arithmetic/sum-of-squares/>Program 10: Sum of Squares</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>Bit Operations</span>
<ul>
<li>
<a href=/docs/bit-operations/signed-numbers/>Signed Numbers</a>
</li>
<li>
<a href=/docs/bit-operations/positivty/>Program 11: All Positivity</a>
</li>
<li>
<a href=/docs/bit-operations/exorcise/>Exorcise and bicycle orr...</a>
</li>
<li>
<a href=/docs/bit-operations/ok-be-negative/>Program 12: Ok, Be Negative</a>
</li>
<li>
<a href=/docs/bit-operations/xor-cipher/>Program 13: XOR Cipher</a>
</li>
<li>
<a href=/docs/bit-operations/shifting/>Shifting and Rotating</a>
</li>
<li>
<a href=/docs/bit-operations/hex-and-love/>Program 14: Hex and Love</a>
</li>
<li>
<a href=/docs/bit-operations/unsale/>Program 15: The Un-sale</a>
</li>
<li>
<a href=/docs/bit-operations/64-bit-math/>Program 16: 64-bit Math</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>Working in Linux</span>
<ul>
<li>
<a href=/docs/working-in-linux/add-the-arguments/>Program 17: Add the Arguments</a>
</li>
<li>
<a href=/docs/working-in-linux/add-the-inputs/>Program 18: Add the Inputs</a>
</li>
<li>
<a href=/docs/working-in-linux/add-the-file/>Program 19: Add the File</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>Appendix A: VFP Coprocessor</span>
<ul>
<li>
<a href=/docs/fpu/overview/>FPU Overview</a>
</li>
<li>
<a href=/docs/fpu/here-to-there/>Program 20: Here to There</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>Appendix B: NEON Coprocessor</span>
<ul>
<li>
<a href=/docs/neon/overview/ class=active>NEON Overview</a>
</li>
<li>
<a href=/docs/neon/bus-rider/>Program 21: Bus Rider</a>
</li>
</ul>
</li>
</ul>
</nav>
<script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>
</div>
</aside>
<div class=book-page>
<header class=book-header>
<div class="flex align-center justify-between">
<label for=menu-control>
<img src=/svg/menu.svg class=book-icon alt=Menu>
</label>
<strong>NEON Overview</strong>
<label for=toc-control>
<img src=/svg/toc.svg class=book-icon alt="Table of Contents">
</label>
</div>
<aside class="hidden clearfix">
<nav id=TableOfContents>
<ul>
<li><a href=#registers>Registers</a>
<ul>
<li><a href=#lanes>Lanes</a></li>
</ul>
</li>
<li><a href=#mnemonics>Mnemonics</a>
<ul>
<li><a href=#mod>&lt;mod></a></li>
<li><a href=#shape>&lt;shape></a></li>
<li><a href=#cond>&lt;cond></a></li>
<li><a href=#dt>.&lt;dt></a></li>
<li><a href=#scalar-data>Scalar data</a></li>
</ul>
</li>
<li><a href=#compiling>Compiling</a></li>
</ul>
</nav>
</aside>
</header>
<article class=markdown><h1 id=neon-overview>
NEON Overview
<a class=anchor href=#neon-overview>#</a>
</h1>
<p>With all of the cool things computers can do these days, this may be one of the
most exciting things. Many times in computing you need to do the same operation
to a set of data. This could include color correcting pixels on a screen,
running a cryptography algorithm, and determining reflection/blur results. For
the longest time, processors were limited to calculating these with one instruction
that resulted in one data point. (i.e., single instruction, single data or SISD)
But NOW there are processors that can perform one instruction to transform
multiple data points. (i.e., single instruction, multiple data or SIMD) The NEON
co-processor in the ARM chips is their SIMD implementation.</p>
<p>There is going to be a lot of information written below with very little examples.
It is all important as NEON adds a lot of possibilities. For any question you
have, <a href=https://usermanual.wiki/Document/DEN0018Aneonprogrammersguide.1958102256/view>here is a link to the docs for the NEON co-processor</a>
Also, worth noting, generally compilers and assemblers and analyzers are not
great at detecting opportunities to implement this automatically and need at
least some hints from the programmer. There are some libraries in different
languages that can help, but again outside the scope of these lessons.</p>
<h2 id=registers>
Registers
<a class=anchor href=#registers>#</a>
</h2>
<p>If your chip has the NEON co-processor, it either also has the VFP or has the
VFP integrated into the NEON co-processor. For this reason, NEON uses the same
registers that the VFP uses, but can also look at them from a larger view.</p>
<p>NEON cannot address the S registers directly, but it can address the D registers
directly. In addition, it can look at the registers from a <strong>Q</strong>uad (128-bit)
viewpoint that combines two D registers.</p>
<div class=highlight><pre tabindex=0 style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>Not Addressable | D regs | Q Regs | 
    S0              D0      Q0
    S1
    S2              D1      
    S3
    S4              D2      Q1
    S5  
    S6              D3      
    S7 
    S8              D4      Q2  
    ... (Ends S31)
                    D31     Q15
                    D32
</code></pre></div><h3 id=lanes>
Lanes
<a class=anchor href=#lanes>#</a>
</h3>
<p>NEON cannot do 128-bit math. The reason why it has space this large is because
you can put data into &ldquo;lanes&rdquo; in order to do the parallel processing. A 128-bit
register can have:</p>
<ul>
<li>16 8-bit lanes</li>
<li>8 16-bit lanes</li>
<li>4 32-bit lanes</li>
<li>2 64-bit lanes</li>
</ul>
<p>You can also use the D registers to provide 64-bit space total which will provide
half of the above lanes for each dat size.</p>
<h2 id=mnemonics>
Mnemonics
<a class=anchor href=#mnemonics>#</a>
</h2>
<p>Many of the same V operations can be used but the syntax is slightly different.
The syntax is:</p>
<pre tabindex=0><code>V{&lt;mod&gt;}&lt;instruction&gt;{&lt;shape&gt;}{&lt;cond&gt;}{.&lt;dt&gt;} &lt;dest1&gt;{, &lt;dest2&gt;}, &lt;src1&gt;{, &lt;src2&gt;}
</code></pre><h3 id=mod>
&lt;mod>
<a class=anchor href=#mod>#</a>
</h3>
<p>This modifies the instruction on how to handle things like overflow and underflow.
It can be one of the following or omitted:</p>
<ul>
<li>Q (saturation): Each element in the result vector is set to either the maximum
or minimum if it exceeds the representable range.</li>
<li>H (halved): Each element shifted right by one place (effectively a divide by
two with truncation).</li>
<li>D (double): The opposite of halved. The doubling happens before any saturation
would take place.</li>
<li>R (rounded): The instruction rounds the result to correct for the bias caused
by truncation. This is equivalent to adding 0.5 to the result before truncating.</li>
</ul>
<h3 id=shape>
&lt;shape>
<a class=anchor href=#shape>#</a>
</h3>
<p>When an operation is performed, there are always as many outputs as there are
inputs. Sometimes the size of the data after an operation creates is different.
(e.g., think about how it takes 32-bit to store two 16-bit numbers multiplied
together) These are for those instances, but can be omitted if they don&rsquo;t apply.</p>
<ul>
<li>L (long): Operands are the same width. Number of bits in each result element
is double the number of bits in each operand element.</li>
<li>N (narrow): Operands are the same width. Number of bits in each result element
is half the number of bits in each operand element.</li>
<li>W (wide): Result and operand are twice the width of the second operand.</li>
</ul>
<h3 id=cond>
&lt;cond>
<a class=anchor href=#cond>#</a>
</h3>
<p>This refers to the conditional execution depending on CPSR settings.</p>
<h3 id=dt>
.&lt;dt>
<a class=anchor href=#dt>#</a>
</h3>
<p>This is the data type. This is similar to the way that the FPU used the <code>.f32</code>
and <code>.f64</code> but refers to the lane size. They include:</p>
<ul>
<li>U8, U16, U32, U64: unsigned integers</li>
<li>S8, S16, S32, S64: signed integers</li>
<li>I8, I16, I32, I64: unspecified integer</li>
<li>F16<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>, F32: floating point</li>
<li>P8, P16: <a href=https://www.doc.ic.ac.uk/~mrh/330tutor/ch04s04.html>Polynomial over {0,1}</a></li>
</ul>
<h3 id=scalar-data>
Scalar data
<a class=anchor href=#scalar-data>#</a>
</h3>
<p>Scalar refers to a single value instead of a vector containing multiple values.
Some NEON instructions use a scalar operand. A scalar inside a register is
accessed by index into the vector of values.</p>
<div class=highlight><pre tabindex=0 style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-armasm data-lang=armasm>    vmov.i8         <span style=color:#cb4b16>d0</span>[3], <span style=color:#cb4b16>r3</span>   <span style=color:#93a1a1;font-style:italic>@ move r3 into the 4th byte of d0 
</span><span style=color:#93a1a1;font-style:italic></span>                                <span style=color:#93a1a1;font-style:italic>@ this is because it is zero indexed. 
</span></code></pre></div><h2 id=compiling>
Compiling
<a class=anchor href=#compiling>#</a>
</h2>
<p>As with the FPV, you will need to tell the assembler that you are expecting a
processor that has extended features. Below should work for most processors with
fpu and NEON support. If it doesn&rsquo;t, you will need to find the exact match. The
docs linked at the beginning of this lesson will help.</p>
<div class=highlight><pre tabindex=0 style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>as -mfpu=neon-vfpv4 -o main.o main.s
</code></pre></div><section class=footnotes role=doc-endnotes>
<hr>
<ol>
<li id=fn:1 role=doc-endnote>
<p>Not all NEON co-processors support F16.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p>
</li>
</ol>
</section>
</article>
<footer class=book-footer>
<div class="flex flex-wrap justify-between">
</div>
<script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){if(window.getSelection().toString())return;a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script>
</footer>
<div class=book-comments>
</div>
<label for=menu-control class="hidden book-menu-overlay"></label>
</div>
<aside class=book-toc>
<div class=book-toc-content>
<nav id=TableOfContents>
<ul>
<li><a href=#registers>Registers</a>
<ul>
<li><a href=#lanes>Lanes</a></li>
</ul>
</li>
<li><a href=#mnemonics>Mnemonics</a>
<ul>
<li><a href=#mod>&lt;mod></a></li>
<li><a href=#shape>&lt;shape></a></li>
<li><a href=#cond>&lt;cond></a></li>
<li><a href=#dt>.&lt;dt></a></li>
<li><a href=#scalar-data>Scalar data</a></li>
</ul>
</li>
<li><a href=#compiling>Compiling</a></li>
</ul>
</nav>
</div>
</aside>
</main>
</body>
</html>