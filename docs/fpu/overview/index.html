<!doctype html><html lang=en-us dir=ltr>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="FPU Overview #  In addition to the core processor, there can exist an optional co-processor that works with floating point numbers. Since the release, this co-processor has become almost synonymous to the NEON co-processor which you will learn about in the next appendix.
Mnemonics #  Many of the instructions you used with the core processor exist in the FPU, but they are prefixed with a &lsquo;V&rsquo;. A full list is here.">
<meta name=theme-color content="#FFFFFF">
<meta name=color-scheme content="light dark"><meta property="og:title" content="FPU Overview">
<meta property="og:description" content="FPU Overview #  In addition to the core processor, there can exist an optional co-processor that works with floating point numbers. Since the release, this co-processor has become almost synonymous to the NEON co-processor which you will learn about in the next appendix.
Mnemonics #  Many of the instructions you used with the core processor exist in the FPU, but they are prefixed with a &lsquo;V&rsquo;. A full list is here.">
<meta property="og:type" content="article">
<meta property="og:url" content="/docs/fpu/overview/"><meta property="article:section" content="docs">
<title>FPU Overview | ARM Assembly By Example</title>
<link rel=manifest href=/manifest.json>
<link rel=icon href=/favicon.png type=image/x-icon>
<link rel=stylesheet href=/book.min.c58292d36b18b675680ab9baea2029204537b839ea72f258746ec0f32ce8d6c8.css>
<script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.cdf1d3339ad599910ecaf0b922791999eccee31382959665fd94442ac92b40e9.js></script>
<style>.blink_text{animation:.5s blinker linear infinite;color:red}@keyframes blinker{0%{opacity:1}50%{opacity:0}100%{opacity:1}}</style>
</head>
<body dir=ltr>
<input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control>
<main class="container flex">
<aside class=book-menu>
<div class=book-menu-content>
<nav>
<h2 class=book-brand>
<a class="flex align-center" href=/><span>ARM Assembly By Example</span>
</a>
</h2>
<div class=book-search>
<input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/>
<div class="book-search-spinner hidden"></div>
<ul id=book-search-results></ul>
</div>
<ul>
<li class=book-section-flat>
<span>Getting to Hello World</span>
<ul>
<li>
<a href=/docs/getting-to-hello-world/basics/>The Basics</a>
</li>
<li>
<a href=/docs/getting-to-hello-world/exiting/>Program 1: Exiting</a>
</li>
<li>
<a href=/docs/getting-to-hello-world/hello-world/>Program 2: Hello World</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>Registers and Memory</span>
<ul>
<li>
<a href=/docs/registers-and-memory/register-overview/>Register Overview</a>
</li>
<li>
<a href=/docs/registers-and-memory/memory-overview/>Memory Overview</a>
</li>
<li>
<a href=/docs/registers-and-memory/find-the-otter/>Program 3: Find the Otter</a>
</li>
<li>
<a href=/docs/registers-and-memory/memory-copy/>Program 4: Memory Copy</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>Branches and Conditionals</span>
<ul>
<li>
<a href=/docs/branches-and-conditionals/conditionals/>Conditionals</a>
</li>
<li>
<a href=/docs/branches-and-conditionals/branches-and-loops/>Branches and Loops</a>
</li>
<li>
<a href=/docs/branches-and-conditionals/hello-world-revisited/>Program 5: Hello World Revisited</a>
</li>
<li>
<a href=/docs/branches-and-conditionals/sticky-keyboard/>Program 6: Sticky Keyboard</a>
</li>
<li>
<a href=/docs/branches-and-conditionals/inspecting-our-program/>Inspecting Our Program</a>
</li>
<li>
<a href=/docs/branches-and-conditionals/cloning-myself/>Program 7: Cloning Myself</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>Arithmetic</span>
<ul>
<li>
<a href=/docs/arithmetic/errors-and-tests/>Errors and Tests</a>
</li>
<li>
<a href=/docs/arithmetic/datatypes/>Datatypes</a>
</li>
<li>
<a href=/docs/arithmetic/multiplication/>Multiplication</a>
</li>
<li>
<a href=/docs/arithmetic/itoa/>Program 8: ITOA</a>
</li>
<li>
<a href=/docs/arithmetic/the-stack/>The Stack</a>
</li>
<li>
<a href=/docs/arithmetic/factorial/>Program 9: Factorials</a>
</li>
<li>
<a href=/docs/arithmetic/sum-of-squares/>Program 10: Sum of Squares</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>Bit Operations</span>
<ul>
<li>
<a href=/docs/bit-operations/signed-numbers/>Signed Numbers</a>
</li>
<li>
<a href=/docs/bit-operations/positivty/>Program 11: All Positivity</a>
</li>
<li>
<a href=/docs/bit-operations/exorcise/>Exorcise and bicycle orr...</a>
</li>
<li>
<a href=/docs/bit-operations/ok-be-negative/>Program 12: Ok, Be Negative</a>
</li>
<li>
<a href=/docs/bit-operations/xor-cipher/>Program 13: XOR Cipher</a>
</li>
<li>
<a href=/docs/bit-operations/shifting/>Shifting and Rotating</a>
</li>
<li>
<a href=/docs/bit-operations/hex-and-love/>Program 14: Hex and Love</a>
</li>
<li>
<a href=/docs/bit-operations/unsale/>Program 15: The Un-sale</a>
</li>
<li>
<a href=/docs/bit-operations/64-bit-math/>Program 16: 64-bit Math</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>Working in Linux</span>
<ul>
<li>
<a href=/docs/working-in-linux/add-the-arguments/>Program 17: Add the Arguments</a>
</li>
<li>
<a href=/docs/working-in-linux/add-the-inputs/>Program 18: Add the Inputs</a>
</li>
<li>
<a href=/docs/working-in-linux/add-the-file/>Program 19: Add the File</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>Appendix A: VFP Coprocessor</span>
<ul>
<li>
<a href=/docs/fpu/overview/ class=active>FPU Overview</a>
</li>
<li>
<a href=/docs/fpu/here-to-there/>Program 20: Here to There</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>Appendix B: NEON Coprocessor</span>
<ul>
<li>
<a href=/docs/neon/overview/>NEON Overview</a>
</li>
<li>
<a href=/docs/neon/bus-rider/>Program 21: Bus Rider</a>
</li>
</ul>
</li>
</ul>
</nav>
<script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>
</div>
</aside>
<div class=book-page>
<header class=book-header>
<div class="flex align-center justify-between">
<label for=menu-control>
<img src=/svg/menu.svg class=book-icon alt=Menu>
</label>
<strong>FPU Overview</strong>
<label for=toc-control>
<img src=/svg/toc.svg class=book-icon alt="Table of Contents">
</label>
</div>
<aside class="hidden clearfix">
<nav id=TableOfContents>
<ul>
<li><a href=#mnemonics>Mnemonics</a></li>
<li><a href=#registers>Registers</a></li>
<li><a href=#data-section>Data section</a></li>
<li><a href=#compiling>Compiling</a></li>
<li><a href=#quirks>Quirks</a>
<ul>
<li><a href=#rounding-errors>Rounding errors</a></li>
<li><a href=#nan>NaN</a></li>
</ul>
</li>
</ul>
</nav>
</aside>
</header>
<article class=markdown><h1 id=fpu-overview>
FPU Overview
<a class=anchor href=#fpu-overview>#</a>
</h1>
<p>In addition to the core processor, there can exist an optional co-processor
that works with floating point numbers. Since the release, this co-processor
has become almost synonymous to the NEON co-processor which you will learn about
in the next appendix.</p>
<h2 id=mnemonics>
Mnemonics
<a class=anchor href=#mnemonics>#</a>
</h2>
<p>Many of the instructions you used with the core processor exist in the FPU, but
they are prefixed with a &lsquo;V&rsquo;. <a href=https://developer.arm.com/documentation/ddi0439/b/Floating-Point-Unit/FPU-Functional-Description/FPU-instruction-set>A full list is here</a>. You&rsquo;ll also
notice that many of them require you to specify if you want to use 32-bit (single)
or 64-bit (double) precision. You also get to use a new square root instruction!</p>
<h2 id=registers>
Registers
<a class=anchor href=#registers>#</a>
</h2>
<p>There are 32 32-bit registers that can also be addresses as 16 64-bit registers.
The 32 32-bit registers are labeled as s0, s1, s2, etc for <strong>S</strong>ingle precision.<br>
Likewise the double registers are labeled d0, d1, d2, etc. for <strong>D</strong>ouble precision.
Because of this, s0 and s1 combined are the same as d0 and likewise throughout
the registers. (e.g., s2 and s3 are the same as d1, s4 and s5 are the same as d2)</p>
<h2 id=data-section>
Data section
<a class=anchor href=#data-section>#</a>
</h2>
<p>With these new data types, you need new directives to load numbers into memory.
This is done with the following:</p>
<div class=highlight><pre tabindex=0 style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-armasm data-lang=armasm><span style=color:#dc322f;font-weight:700>.data</span>  
<span style=color:#268bd2>numone</span>:<span style=color:#dc322f;font-weight:700>         .single     </span><span style=color:#2aa198;font-weight:700>1.2</span>23, 1<span style=color:#dc322f;font-weight:700>.223</span>    <span style=color:#93a1a1;font-style:italic>@ single precision floating numbers 
</span><span style=color:#93a1a1;font-style:italic></span><span style=color:#268bd2>numtwo</span>:<span style=color:#dc322f;font-weight:700>         .double     </span><span style=color:#2aa198;font-weight:700>1.2</span>23, 1<span style=color:#dc322f;font-weight:700>.223</span>    <span style=color:#93a1a1;font-style:italic>@ double precision &#34;&#34;       &#34;&#34;
</span></code></pre></div><h2 id=compiling>
Compiling
<a class=anchor href=#compiling>#</a>
</h2>
<p>Compiling the programs you write with floating point support requires one change.
When using the FPU you need to tell the compiler which version of the FPU you want
to use. For all Raspberry Pi&rsquo;s, this will work:</p>
<div class=highlight><pre tabindex=0 style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>as -mfpu=vfp -o main.o main.s
</code></pre></div><h2 id=quirks>
Quirks
<a class=anchor href=#quirks>#</a>
</h2>
<h3 id=rounding-errors>
Rounding errors
<a class=anchor href=#rounding-errors>#</a>
</h3>
<p>You may already know about this problem. When you take a number and display it
in a floating point fashion, you are bound to get rounding errors. This is because
the computer doesn&rsquo;t store numbers in a decimal fashion, it uses binary. This can
be mainly avoided by using a fixed point decimal &ndash; but that is not what you have
here. You want an example? Go find your favorite language that uses floating point
numbers, and have it evaluate <code>0.2 + 0.1</code> Your answer more than likely will be
<code>0.30000000000000004</code>. You will learn more about this in the exercise.</p>
<h3 id=nan>
NaN
<a class=anchor href=#nan>#</a>
</h3>
<p>The concept of not a number doesn&rsquo;t really exist core processor. Because everything
can be interpreted in the series of bits, everything can be a number. However, in
floating point numbers, you can have a set of bits that doesn&rsquo;t make a floating
point number. For instance, taking the square root of a negative number produces
a number + <em>i</em>. The way you can detect that the processor didn&rsquo;t complete an
operation successfully is that the exponent number will be all 1&rsquo;s.</p>
</article>
<footer class=book-footer>
<div class="flex flex-wrap justify-between">
</div>
<script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){if(window.getSelection().toString())return;a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script>
</footer>
<div class=book-comments>
</div>
<label for=menu-control class="hidden book-menu-overlay"></label>
</div>
<aside class=book-toc>
<div class=book-toc-content>
<nav id=TableOfContents>
<ul>
<li><a href=#mnemonics>Mnemonics</a></li>
<li><a href=#registers>Registers</a></li>
<li><a href=#data-section>Data section</a></li>
<li><a href=#compiling>Compiling</a></li>
<li><a href=#quirks>Quirks</a>
<ul>
<li><a href=#rounding-errors>Rounding errors</a></li>
<li><a href=#nan>NaN</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</aside>
</main>
</body>
</html>