<!doctype html><html lang=en-us dir=ltr>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="The Stack #  We spoke before about the different places that data can live, now we will dive into how those places are used. Hard Drives/SSDs are use to store data &ldquo;long term.&rdquo; And by long term I mean generally longer than the invocation of a program. It&rsquo;s also used for files that are exceptionally large.
Within the RAM, there are two primary areas: the stack and the heap. These concepts are constructs of the operating system.">
<meta name=theme-color content="#FFFFFF">
<meta name=color-scheme content="light dark"><meta property="og:title" content="The Stack">
<meta property="og:description" content="The Stack #  We spoke before about the different places that data can live, now we will dive into how those places are used. Hard Drives/SSDs are use to store data &ldquo;long term.&rdquo; And by long term I mean generally longer than the invocation of a program. It&rsquo;s also used for files that are exceptionally large.
Within the RAM, there are two primary areas: the stack and the heap. These concepts are constructs of the operating system.">
<meta property="og:type" content="article">
<meta property="og:url" content="/docs/arithmetic/the-stack/"><meta property="article:section" content="docs">
<title>The Stack | ARM Assembly By Example</title>
<link rel=manifest href=/manifest.json>
<link rel=icon href=/favicon.png type=image/x-icon>
<link rel=stylesheet href=/book.min.c58292d36b18b675680ab9baea2029204537b839ea72f258746ec0f32ce8d6c8.css>
<script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.cdf1d3339ad599910ecaf0b922791999eccee31382959665fd94442ac92b40e9.js></script>
<style>.blink_text{animation:.5s blinker linear infinite;color:red}@keyframes blinker{0%{opacity:1}50%{opacity:0}100%{opacity:1}}</style>
</head>
<body dir=ltr>
<input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control>
<main class="container flex">
<aside class=book-menu>
<div class=book-menu-content>
<nav>
<h2 class=book-brand>
<a class="flex align-center" href=/><span>ARM Assembly By Example</span>
</a>
</h2>
<div class=book-search>
<input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/>
<div class="book-search-spinner hidden"></div>
<ul id=book-search-results></ul>
</div>
<ul>
<li class=book-section-flat>
<span>Getting to Hello World</span>
<ul>
<li>
<a href=/docs/getting-to-hello-world/basics/>The Basics</a>
</li>
<li>
<a href=/docs/getting-to-hello-world/exiting/>Program 1: Exiting</a>
</li>
<li>
<a href=/docs/getting-to-hello-world/hello-world/>Program 2: Hello World</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>Registers and Memory</span>
<ul>
<li>
<a href=/docs/registers-and-memory/register-overview/>Register Overview</a>
</li>
<li>
<a href=/docs/registers-and-memory/memory-overview/>Memory Overview</a>
</li>
<li>
<a href=/docs/registers-and-memory/find-the-otter/>Program 3: Find the Otter</a>
</li>
<li>
<a href=/docs/registers-and-memory/memory-copy/>Program 4: Memory Copy</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>Branches and Conditionals</span>
<ul>
<li>
<a href=/docs/branches-and-conditionals/conditionals/>Conditionals</a>
</li>
<li>
<a href=/docs/branches-and-conditionals/branches-and-loops/>Branches and Loops</a>
</li>
<li>
<a href=/docs/branches-and-conditionals/hello-world-revisited/>Program 5: Hello World Revisited</a>
</li>
<li>
<a href=/docs/branches-and-conditionals/sticky-keyboard/>Program 6: Sticky Keyboard</a>
</li>
<li>
<a href=/docs/branches-and-conditionals/inspecting-our-program/>Inspecting Our Program</a>
</li>
<li>
<a href=/docs/branches-and-conditionals/cloning-myself/>Program 7: Cloning Myself</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>Arithmetic</span>
<ul>
<li>
<a href=/docs/arithmetic/errors-and-tests/>Errors and Tests</a>
</li>
<li>
<a href=/docs/arithmetic/datatypes/>Datatypes</a>
</li>
<li>
<a href=/docs/arithmetic/multiplication/>Multiplication</a>
</li>
<li>
<a href=/docs/arithmetic/itoa/>Program 8: ITOA</a>
</li>
<li>
<a href=/docs/arithmetic/the-stack/ class=active>The Stack</a>
</li>
<li>
<a href=/docs/arithmetic/factorial/>Program 9: Factorials</a>
</li>
<li>
<a href=/docs/arithmetic/sum-of-squares/>Program 10: Sum of Squares</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>Bit Operations</span>
<ul>
<li>
<a href=/docs/bit-operations/signed-numbers/>Signed Numbers</a>
</li>
<li>
<a href=/docs/bit-operations/positivty/>Program 11: All Positivity</a>
</li>
<li>
<a href=/docs/bit-operations/exorcise/>Exorcise and bicycle orr...</a>
</li>
<li>
<a href=/docs/bit-operations/ok-be-negative/>Program 12: Ok, Be Negative</a>
</li>
<li>
<a href=/docs/bit-operations/xor-cipher/>Program 13: XOR Cipher</a>
</li>
<li>
<a href=/docs/bit-operations/shifting/>Shifting and Rotating</a>
</li>
<li>
<a href=/docs/bit-operations/hex-and-love/>Program 14: Hex and Love</a>
</li>
<li>
<a href=/docs/bit-operations/unsale/>Program 15: The Un-sale</a>
</li>
<li>
<a href=/docs/bit-operations/64-bit-math/>Program 16: 64-bit Math</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>Working in Linux</span>
<ul>
<li>
<a href=/docs/working-in-linux/add-the-arguments/>Program 17: Add the Arguments</a>
</li>
<li>
<a href=/docs/working-in-linux/add-the-inputs/>Program 18: Add the Inputs</a>
</li>
<li>
<a href=/docs/working-in-linux/add-the-file/>Program 19: Add the File</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>Appendix A: VFP Coprocessor</span>
<ul>
<li>
<a href=/docs/fpu/overview/>FPU Overview</a>
</li>
<li>
<a href=/docs/fpu/here-to-there/>Program 20: Here to There</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>Appendix B: NEON Coprocessor</span>
<ul>
<li>
<a href=/docs/neon/overview/>NEON Overview</a>
</li>
<li>
<a href=/docs/neon/bus-rider/>Program 21: Bus Rider</a>
</li>
</ul>
</li>
</ul>
</nav>
<script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>
</div>
</aside>
<div class=book-page>
<header class=book-header>
<div class="flex align-center justify-between">
<label for=menu-control>
<img src=/svg/menu.svg class=book-icon alt=Menu>
</label>
<strong>The Stack</strong>
<label for=toc-control>
<img src=/svg/toc.svg class=book-icon alt="Table of Contents">
</label>
</div>
<aside class="hidden clearfix">
<nav id=TableOfContents>
<ul>
<li><a href=#how-linux-uses-the-stack>How Linux uses the stack</a>
<ul>
<li><a href=#stack-pointer>Stack Pointer</a></li>
</ul>
</li>
<li><a href=#push-and-pop-operations>PUSH and POP operations</a></li>
</ul>
</nav>
</aside>
</header>
<article class=markdown><h1 id=the-stack>
The Stack
<a class=anchor href=#the-stack>#</a>
</h1>
<p>We spoke before about the different places that data can live, now we will dive into
how those places are used. Hard Drives/SSDs are use to store data &ldquo;long term.&rdquo; And by
long term I mean generally longer than the invocation of a program. It&rsquo;s also used for files
that are exceptionally large.</p>
<p>Within the RAM, there are two primary areas: the stack and the heap. These concepts are
constructs of the operating system. The processor doesn&rsquo;t understand stack and heap in the
same way the processor doesn&rsquo;t understand negative numbers. Because of this, it is up
to the programmer in lower level languages to understand how to use these tools.<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></p>
<h2 id=how-linux-uses-the-stack>
How Linux uses the stack
<a class=anchor href=#how-linux-uses-the-stack>#</a>
</h2>
<p>When a program is started, it is allocated a space in memory (RAM) where it can
store data that it is working with. This memory follows a Last-In-First-Out model. The amount of
memory that is allocated to the running program is determined by the operating system. The
other oddity is that the stack &ldquo;grows&rdquo; <em>down</em>.</p>
<p>Here is an example:</p>
<table>
<thead>
<tr>
<th>Address</th>
<th>Order Added</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x0100</td>
<td>1st</td>
</tr>
<tr>
<td>0x00FC</td>
<td>2nd</td>
</tr>
<tr>
<td>0x00F8</td>
<td>3rd</td>
</tr>
<tr>
<td>0x00F4</td>
<td>4th</td>
</tr>
</tbody>
</table>
<h3 id=stack-pointer>
Stack Pointer
<a class=anchor href=#stack-pointer>#</a>
</h3>
<p>There was a small warning when talking about the registers that said &ldquo;don&rsquo;t touch r13!&rdquo; r13 is what is called
the stack pointer. This is simply an address to a place in RAM where the last value was put in the stack.
When we put data into the stack, or remove data, we need to make sure this pointer is moving to the correct
place in order to avoid memory leaks. Some commands, like push and pop below, do this for us automatically.
Other situations, like managing stack frames, may require a little more interaction.</p>
<h2 id=push-and-pop-operations>
PUSH and POP operations
<a class=anchor href=#push-and-pop-operations>#</a>
</h2>
<p>To get information on and off the stack, we can <strong>push</strong> and <strong>pop</strong> the values. When we use
the push and pop commands, we are really just calling the store multiple (STM) and load multiple
(LDM) instructions with a little syntax sugar.<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> You can either push/pop a single register or multiple ones.</p>
<div class=highlight><pre tabindex=0 style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-armasm data-lang=armasm>    push    {<span style=color:#cb4b16>r0</span>-<span style=color:#cb4b16>r3</span>}     <span style=color:#93a1a1;font-style:italic>@ pushes (saves) r0-r3 onto the stack 
</span><span style=color:#93a1a1;font-style:italic></span>                        <span style=color:#93a1a1;font-style:italic>@ above can also be written
</span><span style=color:#93a1a1;font-style:italic></span>                        <span style=color:#93a1a1;font-style:italic>@ push {r0, r1, r2, r3} 
</span><span style=color:#93a1a1;font-style:italic></span>    add     <span style=color:#cb4b16>r1</span>, #<span style=color:#2aa198;font-weight:700>2</span>      <span style=color:#93a1a1;font-style:italic>@ adds 2 to r1 
</span><span style=color:#93a1a1;font-style:italic></span>    pop     {<span style=color:#cb4b16>r0</span>-<span style=color:#cb4b16>r3</span>}     <span style=color:#93a1a1;font-style:italic>@ pops (loads) r0-r3 from the stack 
</span><span style=color:#93a1a1;font-style:italic></span>                        <span style=color:#93a1a1;font-style:italic>@ this would negate the add function 
</span><span style=color:#93a1a1;font-style:italic></span>                        <span style=color:#93a1a1;font-style:italic>@ and restore r0-r3 to their previous 
</span><span style=color:#93a1a1;font-style:italic></span>                        <span style=color:#93a1a1;font-style:italic>@ values from the stack 
</span></code></pre></div><section class=footnotes role=doc-endnotes>
<hr>
<ol>
<li id=fn:1 role=doc-endnote>
<p>Heap management is getting way more into the nitty gritty that this assembly
course plans to get into. This is highly studied and is very case dependant on which is
best to use for certain situations. <a href=http://www.adms-conf.org/2019-camera-ready/durner_adms19.pdf>&ldquo;Light&rdquo; reading for those interested.</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p>
</li>
<li id=fn:2 role=doc-endnote>
<p>More specifically STMDB and LDMIA or decrement address before store and increment address after load, where address refers to the stack pointer. We&rsquo;ll get there in a second.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p>
</li>
</ol>
</section>
</article>
<footer class=book-footer>
<div class="flex flex-wrap justify-between">
</div>
<script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){if(window.getSelection().toString())return;a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script>
</footer>
<div class=book-comments>
</div>
<label for=menu-control class="hidden book-menu-overlay"></label>
</div>
<aside class=book-toc>
<div class=book-toc-content>
<nav id=TableOfContents>
<ul>
<li><a href=#how-linux-uses-the-stack>How Linux uses the stack</a>
<ul>
<li><a href=#stack-pointer>Stack Pointer</a></li>
</ul>
</li>
<li><a href=#push-and-pop-operations>PUSH and POP operations</a></li>
</ul>
</nav>
</div>
</aside>
</main>
</body>
</html>